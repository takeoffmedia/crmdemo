angular.module("autoFields",["ui.bootstrap"]).directive("autoFields",["$compile",function(e,t){return{restrict:"E",priority:1,replace:true,compile:function(){return function(t,n,r){var i=r.fields||r.autoFields,s=r.options,o=r.data,u=null;var a={classes:{formGroup:"form-group",input:"form-control",submit:"btn-default",submitValid:"btn-primary",col:"col-sm-"},container:'<div class="autoFields" ng-form name="autoFields"></div>',defaultOption:"Select One",dateSettings:{showWeeks:false},textareaRows:3,fixUrl:true};t.dateSettings=a.dateSettings;if(t.tabIndex==null)t.tabIndex=1;var f=function(e,t){var n='<div class="'+a.classes.formGroup+" "+e.type+'">';switch(e.type){case"checkbox":n+=p(e,t);break;case"multiple":n+=h(e,t);break;case"date":n+=c(e);n+=d(e,t);break;case"select":n+=c(e);n+=m(e,t);break;case"textarea":n+=c(e);n+=g(e,t);break;default:n+=c(e);n+=y(e,t);break}n+="</div>";return n};var l=function(e){return e.label||E(e.property)};var c=function(e){return'<label for="'+e.property+'">'+l(e)+"</label>"};var h=function(e,t){var n='<div class="row">';var r=[];var s=angular.copy(i);i+="["+t+"].fields";angular.forEach(e.fields,function(t,n){var i='<div class="'+a.classes.col+(t.columns||e.columns)+'">';i+=f(t,n);i+="</div>";r.push(i)});i=s;n+=r.join(" ")+"</div>";return n};var p=function(e,t){var n='<label> <input type="checkbox"'+v(e,t)+b(e.attr)+"/> "+l(e)+"</label>";return n};var d=function(e,t){return'<input type="text" show-weeks="dateSettings.showWeeks" datepicker-popup="MMMM dd, yyyy"'+v(e,t)+b(e,t)+" />"};var v=function(e,n){var r=' id="'+e.property+'" tabindex="'+t.tabIndex+'" name="'+e.property+'" ng-model="'+(e.value?"autoForm"+i.replace(/(\[|\])/g,"_")+n+".model":o+"['"+e.property+"']")+'" placeholder="'+(e.placeholder?e.placeholder:l(e))+'" ';if(e.value!=null)r+='value-function="'+i+"["+n+'].value"';if(e.type!="checkbox")r+='class="'+a.classes.input+" "+e.type+'" ';t.tabIndex++;return r};var m=function(e,t){var n='<select ng-options="'+e.list+'"';n+=v(e,t);if(e.attr!=null)n+=b(e.attr);n+=">";n+='<option value="">'+(e.defaultOption?e.defaultOption:a.defaultOption)+"</option>";n+="</select>";return n};var g=function(e,t){var n='<textarea rows="'+(e.rows?e.rows:a.textareaRows)+'"';n+=v(e,t);if(e.attr!=null)n+=b(e.attr);n+="></textarea>";return n};var y=function(e,t){var n='<input type="'+e.type+'"';n+=v(e,t);if(e.attr!=null)n+=b(e.attr);if(e.type=="url"&&(e.fixUrl==true||a.fixUrl==true))n+="fix-url";n+="></input>";return n};var b=function(e,t){var n=[];angular.forEach(e,function(e,t){var r=S(t)+'="'+e+'"';n.push(r)});return n.join(" ")};var w=null;t.$watch(i,function(n){u.html("");angular.forEach(n,function(e,t){u.append(f(e,t))});if(w!=null)w.$destroy();w=t.$new();w.data=t[o];w.fields=n;e(u)(w)},true);t.$watch(s,function(e){angular.copy(a,e)},true);u=angular.element(a.container);n.replaceWith(u);var E=function(e){return e.replace(/([A-Z])/g," $1").replace(/^./,function(e){return e.toUpperCase()})};var S=function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}}}}]).directive("fixUrl",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){var i=/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w\.\-\?\=\&]*)$/i;var s=function(){var e=r.$modelValue;if(e==null)return;for(var t in r.$formatters){e=r.$formatters[t](e)}r.$viewValue=e;r.$render()};t.bind("blur",s);var o=function(e){var t=i.test(e);if(t){var n=e.match(i);var r=n[1]!=null&&n[1]!=""?n[1]:"http://";r+=n[2]+"."+n[3];if(typeof n[4]!="undefined")r+=n[4];e=r}return e};r.$formatters.push(o);r.$parsers.unshift(o)}}}]).directive("valueFunction",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){var i=e.$eval(n.valueFunction);e.$watch(n.valueFunction+"()",function(t){if(t!=null){e.$eval(n.ngModel+"="+n.valueFunction+"()")}});var s=function(t){i(e.$eval(n.ngModel));if(t!==true){e.$apply()}};e.$watch(n.ngModel,function(){if(s!=null){s(true)}})}}}])